<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Facturation Club Judo Anjou: Judoka</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="shortcut icon" href="/files/favicon.ico" type="image/x-icon" />
  <style type="text/css" media="all">@import "styles.css";</style>
</head>

<body>

<script type="text/javascript"  src="gears_init.js"></script>
<script type="text/javascript"  src="dbaccess.js"></script>
<script type="text/javascript"  src="base.js"></script>
<script type="text/javascript"  src="utils.js"></script>
<script type="text/javascript"  src="constants.js"></script>

<h1>Renseignements judoka</h1>
<div><span id="status">&nbsp;</span><div id="sync">synchroniser</div></div>

<form name="client" onSubmit="handleSubmit(); return false;">
<input type="hidden" id="cid" value="" />

<div class="sectionBody" style="padding:7px 0 9px 7px;">
 <fieldset> <legend>Identit&eacute;</legend>
 <div style="padding:10px;">
  <div><label for="nom">Nom</label>
  <input id="nom" type="text" size="32" value="" maxlength="50"></div>
  <div><label for="prenom">Prenom</label>
  <input id="prenom" type="text" size="32" value="" maxlength="50"></div>
  <div><label for="ddn">Date de naissance (aa/mm/jj)</label>
  <input id="ddn" type="text" size="32" value="" maxlength="50" onChange="ddnChange()"></div>
 </div>
 <br />
 </fieldset>

 <fieldset> <legend>Adresse</legend>
 <div style="padding:10px;">
  <label for="courriel">Courriel</label>
  <div><input id="courriel" type="text" size="32" value="" maxlength="255"></div>
  <label for="adresse">Adresse</label>
  <div><input id="adresse" type="text" size="64" value="" maxlength="80"></div>
  <label for="ville">Ville</label>
  <div><input id="ville" type="text" size="32" value="" maxlength="50"></div>
  <label for="tel">T&eacute;l&eacute;phone(s)</label>
  <div><input id="tel" type="text" size="20" value="" maxlength="20"></div>
 </div>
 </fieldset>

 <fieldset> <legend>Autres renseignments</legend>
 <div style="padding:10px;">
  <div><label for="affiliation">N<sup>o</sup> Judo Qu&eacute;bec</label>
  <input id="affiliation" type="text" size="10" value="" maxlength="20"></div>
  <div><label for="carte_anjou">N<sup>o</sup> arrondissement Anjou</label>
  <input id="carte_anjou" type="text" size="16" value="" maxlength="20"></div>
  <div><label for="nom_recu_impot">Nom re&ccedil;u imp&ocirc;t</label>
  <input id="nom_recu_impot" type="text" size="32" value="" maxlength="50"> </div>
 </fieldset>

 <fieldset> <legend>Urgence</legend>
 <div style="padding:10px;">
  <label for="nom_contact_urgence">Contact en cas d'urgence</label>
  <div><input id="nom_contact_urgence" type="text" size="32" value="" maxlength="50"></div>
  <label for="tel_contact_urgence">T&eacute;l&eacute;phone urgence</label>
  <div><input id="tel_contact_urgence" type="text" size="32" value="" maxlength="50"></div>
  <label for="no_RAMQ">N<sup>o</sup> RAMQ</label>
  <div><input id="RAMQ" type="text" size="20" value="" maxlength="20"></div>
 </div>
 </fieldset>

 <fieldset> <legend>Frais</legend>
 <div style="padding:10px;">
  <label for="categorie">Cat&eacute;gorie d'&acirc;ge</label>
  <div><input id="categorie" type="text" value="" readonly></div>
 </div>
 </fieldset>

 <input id="version" type="hidden" value="">
 <input id="server_version" type="hidden" value="">

 <div class="actions">
 <a href="clients.html" onClick="handleSubmit(); return false">Sauvegarder</a>
 <a href="clients.html" onClick="handleSubmit()">Sauvegarder et retourner</a>
 <a href="clients.html">Annuler</a>
 </div>
</form>

<script>
// Courtesy http://www.netlobo.com/url_query_string_javascript.html
function gup( name )
{
  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results == null )
    return null;
  else
    return results[1];
}

var fields = ["nom", "prenom", "ddn", "courriel", "adresse", "ville", "tel", "affiliation", "carte_anjou", "nom_recu_impot", "nom_contact_urgence", "tel_contact_urgence", "RAMQ", "version", "server_version"]

var cid = gup("cid");
var db;

init();
localInit();

function localInit() {
  if (cid)
    populateClient(cid);
}

function populateClient() {
  var rs = executeToObjects(db, 'select * from client where id = '+cid)[0];
  if (!rs) { addStatus('cid not found'); return; }

  for (i = 0; i < fields.length; i++) {
    key = fields[i];
    getElementById(key).value = rs[key];
  }
  updateCategorie();
}

function handleSubmit() {
  var rs = {};
  for (i = 0; i < fields.length; i++) {
    key = fields[i];
    rs[key] = getElementById(key).value;
  }

  db.execute('INSERT OR REPLACE INTO `client` ' +
                'VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ',
                [cid, SAISON, rs.nom, rs.prenom, rs.ddn, rs.courriel,
                rs.adresse, rs.ville, rs.tel, rs.affiliation, rs.carte_anjou,
                rs.nom_recu_impot, 
                rs.nom_contact_urgence, rs.tel_contact_urgence, rs.RAMQ,
                rs.version, rs.server_version]);
  cid = db.lastInsertRowId;
  clearStatus(); addStatus("SauvegardÃ©."); setTimeout('clearStatus()', 3000);
}

var oldDDN = getElementById("ddn").value;
function ddnChange() {
  var ddn = getElementById("ddn").value;
  if (validateDate(ddn)) {
    updateCategorie(); 
    clearStatus();
  }
  else {
    getElementById("ddn").value = oldDDN;
    setError("Date de naissance invalide.");
  }
  oldDDN = ddn;
}

function updateCategorie() {
  c = getElementById("categorie");
  y = parseInt(getElementById("ddn").value.substring(0,2));
  if (y + 2000 < SAISON) y = y + 2000; else y = y + 1900;
  var catId = computeCategoryId(y);
  c.value = categoryName(catId);
}
</script>

</body>

</html>
